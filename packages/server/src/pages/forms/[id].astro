---
import { getRouteDataFromQueryString } from '@atj/forms';

import { AppForm } from '../../components/AppForm';
import {
  getAstroAppContext,
  getAstroRouteParams,
  getSearchString,
} from '../../config/astro.js';
import ContentLayout from '../../layouts/ContentLayout.astro';

const { id: formId } = getAstroRouteParams(Astro, ['id']);

const ctx = await getAstroAppContext(Astro);
const formResult = await ctx.formService.getForm(formId);
if (!formResult.success) {
  return new Response(formResult.error.message, {
    status: 404,
  });
}
const sessionResult = await ctx.formService.getFormSession({
  formId,
  formRoute: {
    params: getRouteDataFromQueryString(getSearchString(Astro)),
    url: Astro.url.pathname,
  },
});
if (!sessionResult.success) {
  return new Response(session.error, {
    status: 500,
  });
}
---

<ContentLayout title="10x Access to Justice">
  <AppForm client:load session={sessionResult.data} uswdsRoot={ctx.uswdsRoot} />
</ContentLayout>
