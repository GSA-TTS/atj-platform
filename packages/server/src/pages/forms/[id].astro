---
import { createFormSession, getRouteDataFromQueryString } from '@atj/forms';

import { AppForm } from '../../components/AppForm';
import { getAstroAppContext } from '../../config/astro.js';
import ContentLayout from '../../layouts/ContentLayout.astro';

const { id } = Astro.params;

const ctx = await getAstroAppContext(Astro);
const formResult = await ctx.formService.getForm(id);
if (!formResult.success) {
  return new Response(formResult.error.message, {
    status: 404,
  });
}

const session = createFormSession(formResult.data, {
  params: getRouteDataFromQueryString(Astro.url.search),
  url: Astro.url.pathname,
});
---

<ContentLayout title="10x Access to Justice">
  <AppForm client:load session={session} uswdsRoot={ctx.uswdsRoot} />
</ContentLayout>
